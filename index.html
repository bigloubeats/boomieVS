<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>boomieVS - Debug Host</title>
    <script src="https://cdn.jsdelivr.net/npm/tmi.js@1.8.5/1/tmi.min.js"></script>
    <style>
        :root { --twitch-purple: #9147ff; --bg: #0e0e10; }
        * { box-sizing: border-box; touch-action: manipulation; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #main-interface { display: flex; flex-direction: column; height: 100%; }
        .chat-container { flex: 1; background: #000; }
        iframe { width: 100%; height: 100%; border: none; }
        .controls { background: #18181b; padding: 10px; border-top: 2px solid #333; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn { height: 60px; font-weight: bold; border: none; border-radius: 8px; color: white; background: #26262c; font-size: 0.9rem; }
        #status-box { background: #000; color: #4ade80; font-family: monospace; font-size: 0.7rem; padding: 8px; margin-bottom: 8px; border: 1px solid #333; height: 60px; overflow-y: auto; }
        .login-screen { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 2000; }
    </style>
</head>
<body>

    <div id="login-layer" class="login-screen">
        <button onclick="login()" style="padding: 20px 40px; background: var(--twitch-purple); color: white; border: none; border-radius: 8px; font-weight: bold;">CONNECT TWITCH</button>
    </div>

    <div id="main-interface" style="display:none;">
        <div class="chat-container" id="chat-target"></div>
        <div class="controls">
            <div id="status-box">SYSTEM: Initializing...</div>
            <div class="grid">
                <button class="btn" onclick="send('!startgame')">START</button>
                <button class="btn" onclick="send('!hostcatch')">CATCH</button>
                <button class="btn" onclick="send('!hostdrop')">DROP</button>
                <button class="btn" onclick="send('!hostminus')">MINUS</button>
            </div>
        </div>
    </div>

    <script>
        const CLIENT_ID = 'i5dxhow968w291edfu4ll4sucr3buf'; 
        const CHANNEL = 'bigloubeats81';
        const REDIRECT_URI = 'https://bigloubeats.github.io/boomieVS/index.html';
        let client;

        function log(msg) {
            const box = document.getElementById('status-box');
            box.innerHTML += `<div>> ${msg}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        function login() {
            const scope = encodeURIComponent('chat:edit chat:read');
            window.location.href = `https://id.twitch.tv/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${scope}`;
        }

        const params = new URLSearchParams(window.location.hash.replace('#', '?'));
        const token = params.get('access_token');

        if (token) {
            document.getElementById('login-layer').style.display = 'none';
            document.getElementById('main-interface').style.display = 'flex';
            log("Token found. Starting TMI...");

            document.getElementById('chat-target').innerHTML = `<iframe src="https://www.twitch.tv/embed/${CHANNEL}/chat?parent=bigloubeats81.github.io&parent=bigloubeats.github.io&darkpopout" height="100%" width="100%"></iframe>`;

            client = new tmi.Client({
                options: { debug: false },
                connection: { reconnect: true, secure: true },
                identity: { username: 'bigloubeats81', password: `oauth:${token}` },
                channels: [ CHANNEL ]
            });

            client.on('connected', () => log("CONNECTED TO CHAT"));
            client.on('disconnected', (reason) => log("DISCONNECTED: " + reason));
            client.on('notice', (chan, msgid, msg) => log("TWITCH NOTICE: " + msg));

            client.connect().catch(e => log("CONN ERROR: " + e));
        }

        window.send = (cmd) => {
            if (!client || client.readyState() !== "OPEN") {
                log("CANNOT SEND: Not connected");
                return;
            }
            client.say(CHANNEL, cmd).then(() => log("SENT: " + cmd)).catch(e => log("SEND ERROR: " + e));
        };
    </script>
</body>
</html>
